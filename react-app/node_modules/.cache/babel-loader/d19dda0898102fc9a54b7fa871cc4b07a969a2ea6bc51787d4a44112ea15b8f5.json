{"ast":null,"code":"import\"./Cards.css\";import{useEffect,useState}from\"react\";import{useParams}from\"react-router-dom\";import axios from\"axios\";import{useUserProgress}from\"../UserProgressContext\";import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";export default function Cards(){const{completedUnits,refreshProgress}=useUserProgress();const{courseId}=useParams();const[flashcards,setFlashcards]=useState([]);const[currentIndex,setCurrentIndex]=useState(0);const[userAnswer,setUserAnswer]=useState(\"\");const[correctAnswers,setCorrectAnswers]=useState(0);const[showResult,setShowResult]=useState(false);const[feedback,setFeedback]=useState(null);const[isAnswered,setIsAnswered]=useState(false);useEffect(()=>{const fetchFlashcards=async()=>{try{const apiUrl=process.env.REACT_APP_API_URL;const response=await axios.get(`${apiUrl}/api/learning/cards/${courseId}`);const shuffledCards=response.data.sort(()=>0.5-Math.random()).slice(0,5);setFlashcards(shuffledCards);}catch(error){console.error(\"Error fetching flashcards:\",error);}};fetchFlashcards();},[courseId]);const updateUserCourse=async isCompleted=>{try{const apiUrl=process.env.REACT_APP_API_URL;const userString=localStorage.getItem(\"user\");if(!userString)return;const user=JSON.parse(userString);const userId=user.id;// Call the API to update UserCourse (increment attempts and set completion status)\nawait axios.post(`${apiUrl}/api/usercourse`,{Id:userId,CourseId:courseId,IsCompleted:isCompleted});}catch(error){console.error(\"Error updating UserCourse:\",error);}};const completeUnit=async()=>{try{const apiUrl=process.env.REACT_APP_API_URL;const userString=localStorage.getItem(\"user\");if(!userString)return;const user=JSON.parse(userString);const userId=user.id;const isCompleted=correctAnswers>=3;// Update user progress if the course is completed\nif(isCompleted){await axios.post(`${apiUrl}/api/learning/complete`,{Id:userId,CorrectAnswers:correctAnswers});refreshProgress();}}catch(error){console.error(\"Error updating completed units:\",error);}};const checkAnswer=()=>{const isCorrect=userAnswer.trim().toLowerCase()===flashcards[currentIndex].norwegianText.toLowerCase();if(isCorrect){setCorrectAnswers(prev=>prev+1);setFeedback(\"✅ Riktig!\");}else{setFeedback(`❌ Feil! Riktig svar: ${flashcards[currentIndex].norwegianText}`);}setIsAnswered(true);setTimeout(async()=>{try{if(currentIndex+1<flashcards.length){// Move to the next flashcard\nsetCurrentIndex(prev=>prev+1);setUserAnswer(\"\");setFeedback(null);setIsAnswered(false);}else{// User has finished the flashcards\nconst isCompleted=correctAnswers+(isCorrect?1:0)>=3;// Update UserCourse (increment attempts and set completion status)\nawait updateUserCourse(isCompleted);// Complete the unit if the user passed\nif(isCompleted){await completeUnit();}// Show the result\nsetShowResult(true);}}catch(error){console.error(\"Error during setTimeout operation:\",error);}},2500);};return/*#__PURE__*/_jsx(\"div\",{className:\"flashcard-container\",children:showResult?/*#__PURE__*/_jsxs(\"div\",{className:\"result\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Du fikk \",correctAnswers,\" av \",flashcards.length,\" riktige!\"]}),correctAnswers>=3?/*#__PURE__*/_jsx(\"p\",{children:\"\\u2705 Du kan g\\xE5 videre til neste unit!\"}):/*#__PURE__*/_jsx(\"p\",{children:\"\\u274C Pr\\xF8v igjen for \\xE5 best\\xE5 denne unit.\"})]}):flashcards.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flashcard-wrapper\",children:[feedback&&/*#__PURE__*/_jsx(\"p\",{className:\"feedback\",children:feedback}),/*#__PURE__*/_jsxs(\"div\",{className:\"flashcard\",children:[/*#__PURE__*/_jsx(\"h2\",{children:flashcards[currentIndex].englishText}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:userAnswer,onChange:e=>setUserAnswer(e.target.value),placeholder:\"Skriv p\\xE5 norsk\",disabled:isAnswered}),/*#__PURE__*/_jsx(\"button\",{onClick:checkAnswer,disabled:isAnswered,children:\"Submit\"})]})]})});}","map":{"version":3,"names":["useEffect","useState","useParams","axios","useUserProgress","jsxs","_jsxs","jsx","_jsx","Cards","completedUnits","refreshProgress","courseId","flashcards","setFlashcards","currentIndex","setCurrentIndex","userAnswer","setUserAnswer","correctAnswers","setCorrectAnswers","showResult","setShowResult","feedback","setFeedback","isAnswered","setIsAnswered","fetchFlashcards","apiUrl","process","env","REACT_APP_API_URL","response","get","shuffledCards","data","sort","Math","random","slice","error","console","updateUserCourse","isCompleted","userString","localStorage","getItem","user","JSON","parse","userId","id","post","Id","CourseId","IsCompleted","completeUnit","CorrectAnswers","checkAnswer","isCorrect","trim","toLowerCase","norwegianText","prev","setTimeout","length","className","children","englishText","type","value","onChange","e","target","placeholder","disabled","onClick"],"sources":["C:/Users/dyako/OneDrive/Skrivebord/StudyProjects/LanguageLearningApp/react-app/src/Components/Cards/Cards.tsx"],"sourcesContent":["import \"./Cards.css\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { useUserProgress } from \"../UserProgressContext\";\r\n\r\n\r\ninterface Cards {\r\n  id: number;\r\n  englishText: string;\r\n  norwegianText: string;\r\n}\r\n\r\n\r\nexport default function Cards() {\r\n  const { completedUnits, refreshProgress } = useUserProgress();\r\n  const { courseId } = useParams<{ courseId: string }>();\r\n  const [flashcards, setFlashcards] = useState<Cards[]>([]);\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [userAnswer, setUserAnswer] = useState(\"\");\r\n  const [correctAnswers, setCorrectAnswers] = useState(0);\r\n  const [showResult, setShowResult] = useState(false);\r\n  const [feedback, setFeedback] = useState<string | null>(null);\r\n  const [isAnswered, setIsAnswered] = useState(false);\r\n\r\n\r\n  useEffect(() => {\r\n    const fetchFlashcards = async () => {\r\n      try {\r\n        const apiUrl = process.env.REACT_APP_API_URL;\r\n        const response = await axios.get<Cards[]>(`${apiUrl}/api/learning/cards/${courseId}`);\r\n        const shuffledCards = response.data.sort(() => 0.5 - Math.random()).slice(0, 5);\r\n        setFlashcards(shuffledCards);\r\n      } catch (error) {\r\n        console.error(\"Error fetching flashcards:\", error);\r\n      }\r\n    };\r\n\r\n    fetchFlashcards();\r\n  }, [courseId]);\r\n\r\n  const updateUserCourse = async (isCompleted: boolean) => {\r\n    try {\r\n      const apiUrl = process.env.REACT_APP_API_URL;\r\n      const userString = localStorage.getItem(\"user\");\r\n      if (!userString) return;\r\n\r\n      const user = JSON.parse(userString);\r\n      const userId = user.id;\r\n\r\n      // Call the API to update UserCourse (increment attempts and set completion status)\r\n      await axios.post(`${apiUrl}/api/usercourse`, {\r\n        Id: userId,\r\n        CourseId: courseId,\r\n        IsCompleted: isCompleted,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error updating UserCourse:\", error);\r\n    }\r\n  };\r\n\r\n  const completeUnit = async () => {\r\n    try {\r\n      const apiUrl = process.env.REACT_APP_API_URL;\r\n      const userString = localStorage.getItem(\"user\");\r\n      if (!userString) return;\r\n\r\n      const user = JSON.parse(userString);\r\n      const userId = user.id;\r\n\r\n      const isCompleted = correctAnswers >= 3;\r\n\r\n      // Update user progress if the course is completed\r\n      if (isCompleted) {\r\n        await axios.post(`${apiUrl}/api/learning/complete`, {\r\n          Id: userId,\r\n          CorrectAnswers: correctAnswers,\r\n        });\r\n\r\n        refreshProgress();\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error updating completed units:\", error);\r\n    }\r\n  };\r\n\r\n  const checkAnswer = () => {\r\n    const isCorrect = userAnswer.trim().toLowerCase() === flashcards[currentIndex].norwegianText.toLowerCase();\r\n\r\n    if (isCorrect) {\r\n      setCorrectAnswers((prev) => prev + 1);\r\n      setFeedback(\"✅ Riktig!\");\r\n    } else {\r\n      setFeedback(`❌ Feil! Riktig svar: ${flashcards[currentIndex].norwegianText}`);\r\n    }\r\n\r\n    setIsAnswered(true);\r\n\r\n    setTimeout(async () => {\r\n      try {\r\n        if (currentIndex + 1 < flashcards.length) {\r\n          // Move to the next flashcard\r\n          setCurrentIndex((prev) => prev + 1);\r\n          setUserAnswer(\"\");\r\n          setFeedback(null);\r\n          setIsAnswered(false);\r\n        } else {\r\n          // User has finished the flashcards\r\n          const isCompleted = correctAnswers + (isCorrect ? 1 : 0) >= 3;\r\n\r\n          // Update UserCourse (increment attempts and set completion status)\r\n          await updateUserCourse(isCompleted);\r\n\r\n          // Complete the unit if the user passed\r\n          if (isCompleted) {\r\n            await completeUnit();\r\n          }\r\n\r\n          // Show the result\r\n          setShowResult(true);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error during setTimeout operation:\", error);\r\n      }\r\n    }, 2500);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flashcard-container\">\r\n      {showResult ? (\r\n        <div className=\"result\">\r\n          <h2>Du fikk {correctAnswers} av {flashcards.length} riktige!</h2>\r\n          {correctAnswers >= 3 ? <p>✅ Du kan gå videre til neste unit!</p> : <p>❌ Prøv igjen for å bestå denne unit.</p>}\r\n        </div>\r\n      ) : (\r\n        flashcards.length > 0 && (\r\n          <div className=\"flashcard-wrapper\">\r\n            {feedback && <p className=\"feedback\">{feedback}</p>}\r\n            <div className=\"flashcard\">\r\n              <h2>{flashcards[currentIndex].englishText}</h2>\r\n              <input\r\n                type=\"text\"\r\n                value={userAnswer}\r\n                onChange={(e) => setUserAnswer(e.target.value)}\r\n                placeholder=\"Skriv på norsk\"\r\n                disabled={isAnswered}\r\n              />\r\n              <button onClick={checkAnswer} disabled={isAnswered}>Submit</button>\r\n            </div>\r\n          </div>\r\n        )\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}